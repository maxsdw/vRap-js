/* @preserve vRap.js JavaScript Framework v1.0.0 | Based on jQuery 2+ | https://github.com/maxsdw/vRap-js | (c) 2014, Jonathan Mauricio Sánchez Sanabria | Released under the MIT license */
/**
 * Release Date: 2-12-2015
 */
// vRap Framework
!function(){var a={Apps:{},Classes:{},Properties:{activeApp:null,idCounter:0},Query:{getApp:function(a){var b=vRap.Apps[a];return b?b:(vRap.Msg.alert(vRap.Locale.alertMessages.noApp),!1)},getClass:function(a){var b=a.split("."),c=vRap.Classes;return $.each(b,function(a,b){c=c[b]}),c?c:(vRap.Msg.alert(vRap.Locale.alertMessages.noNamespace+" | "+a),!1)},getObj:function(a){var b,c,d;return b=this.getApp(vRap.Properties.activeApp),c=b.objManager,d=a.split("."),$.each(d,function(b,d){return c?void(c=c[d]):(vRap.Msg.alert(vRap.Locale.alertMessages.noObject+" | "+a),!1)}),c},getObjsByClass:function(a){var b,c,d=[];return b=this.getApp(vRap.Properties.activeApp),c=function(b){$.each(b,function(b,e){e._classNamespace?e._classNamespace===a&&d.push(e):c(e)})},c(b.objManager),d},getEvents:function(a){return $._data(a,"events")}},Generators:{genIdNumber:function(){return vRap.Properties.idCounter+=1,vRap.Properties.idCounter}},Actions:{newApp:function(a){var b=new $.Deferred;return"string"!==$.type(a.appName)&&(a.appName=String(a.appName)),vRap.Apps[a.appName]={objManager:{},references:{controllers:{},usedAlias:[]}},vRap.Properties.activeApp=a.appName,b.resolve(),vRap.Apps[a.appName]},switchApp:function(a){var b=vRap.Apps[a];return b?void(vRap.Properties.activeApp=a):(vRap.Msg.alert(vRap.Locale.alertMessages.noApp+" | "+a),!1)},define:function(a,b,c){var d,e,f,g=a.split("."),h=vRap.Classes;b.extend&&(d=vRap.Query.getClass(b.extend),b._extend=b.extend,delete b.extend),$.each(g,function(c,e){c<g.length-1?h[e]||(h[e]={}):h[e]=function(c){var e=this;
// Calling the superClass constructor
d&&d.call(e),
// Setting default properties
e.observerList=[],e.linked={},e.properties={booted:!1,initialized:!1},e.properties=$.extend(e.properties,{}),
// Setting class name
e._classNamespace=a,
// Adding API properties
$.each(b,function(a,c){$.isFunction(b[a])||("properties"===a?$.extend(e.properties,b[a]):e[a]=c)});for(f in c)"function"===$.type(c[f])?e[f]=c[f]:e.properties[f]=c[f]},h=h[e]}),e=h,d&&(e.prototype=Object.create(d.prototype),e.prototype.constructor=e),$.each(b,function(a,c){$.isFunction(b[a])&&(e.prototype[a]=c)}),$.isEmptyObject(c)||$.each(c,function(a,b){e[a]=b})},create:function(a,b,c){var d,e,f,g,h=this,i=new $.Deferred;return"object"===$.type(a)&&a.instances||a.interfaces?$.when(h._classIterator(a)).done(function(){i.resolve()}):(e=vRap.Query.getClass(a),e&&(d=vRap.Query.getApp(vRap.Properties.activeApp),d&&(f=b.split("."),g=d.objManager,$.each(f,function(a,b){a<f.length-1?g[b]||(g[b]={}):g[b]=new e(c),g=g[b]}),g._objectNamespace=b,g.properties.id="vRap_"+b.toLowerCase().replace(/\./g,"_")+"_"+vRap.Generators.genIdNumber(),g.properties.alias&&(d.references.usedAlias.indexOf(g.properties.alias)<0?d.references.usedAlias.push(g.properties.alias):vRap.Msg.alert(vRap.Locale.alertMessages.duplicatedAlias+" | Object: "+b+" | Alias: "+g.properties.alias)),$.when(g._boot()).done(function(){g.properties.booted=!0,g.init?$.when(g.init()).done(function(a){g.properties.initialized=!0,i.resolve(g,a)}):vRap.Msg.alert(vRap.Locale.alertMessages.noInit+" | "+b)})))),i.promise()},destroy:function(a){var b,c,d,e,f=new $.Deferred,g=0;return b=vRap.Query.getApp(vRap.Properties.activeApp),c=vRap.Query.getObj(a),d=a.split("."),e=function(b,c){b[c]._objectNamespace&&b[c]._objectNamespace===a?(b[c]=null,delete b[c],f.resolve()):e(b[c],d[g+=1])},c?(c.properties.domEl&&c.properties.domEl.remove(),e(b.objManager,d[g])):f.resolve(),f.promise()},destroyByClass:function(a){$.each(vRap.Query.getObjsByClass(a),function(a,b){vRap.destroy(b._objectNamespace)})},addCustomListener:function(a){var b=vRap.Query.getObj(a.component).domEl;b.off(a.eventType),b.on(a.eventType,a.method)},_classIterator:function(a){var b,c=new $.Deferred,d=0,e=!1,f=!1,g=[];return b=function(h,i){var j;h&&h.length>0&&h.length>d?(j=h[d],a.async?($.each(a.instances,function(a,b){g.push(vRap.Actions.create(b["class"],b.namespace,b.properties)),d+=1}),$.when.apply($,g).done(function(){b(h,i)})):$.when(vRap.Actions.create(j["class"],j.namespace,j.properties)).done(function(){d+=1,b(h,i)})):("instances"===i?e=!0:"interfaces"===i&&(f=!0),f?c.resolve():(d=0,b(a.interfaces,"interfaces")))},b(a.instances,"instances"),c.promise()}},Msg:{alert:function(a){console.log("%c "+a,"color: red")}}};window.vRap||(window.vRap=a)}(),vRap.Locale={alertMessages:{noApp:"vRap could not find the App instance, create it using the method vRap.newApp().",noNamespace:"Bad namespace specification or namespace doesn't exist.",noInit:"The object constructor specified does not contain an init() method.",noObject:"Object couldn't be found in this application.",badDomEl:"Specified domEl is not a valid jquery selector or the element doesn't exist.",badInsertEl:"Specified InsertTo element is not a valid jquery selector or the element doesn't exist.",noApiOrData:"You must specify an API Url, API configuration or include local data",noApiUrl:"You must specify an API Url inside the model definition",noRefresh:"A refresh method must be defined within the view",noSendData:"You must include the data to be sent to the server",noAlias:"Controllers and all referenced instances inside them must include an alias",duplicatedAlias:"The alias asigned to this object already exists, please pick a different one"}},/**
 * This file is part of vRap.JS JavaScript Framework v1.0.0
 *
 * Copyright 2015, Jonathan Mauricio Sánchez Sanabria
 * Released under the MIT license
 */
vRap.Actions.define("Base.primitives.Foundation",function(){return{_boot:function(){var a=new $.Deferred;return a.resolve()},subscribe:function(a){this.observerList.push(a)},unsubscribe:function(a){var b=this.observerList.indexOf(a,0);b>=0&&this.observerList.splice(b,1)},publish:function(a,b){$.each(this.observerList,function(c,d){d(a,b)})}}}(),{}),/**
 * This file is part of vRap.JS JavaScript Framework v1.0.0
 *
 * Copyright 2015, Jonathan Mauricio Sánchez Sanabria
 * Released under the MIT license
 */
vRap.Actions.define("Base.primitives.Controller",function(){var a;return a=vRap.Locale.alertMessages,{extend:"Base.primitives.Foundation",properties:{type:"controller"},_boot:function(){var b=this,c=new $.Deferred;return b.properties.alias?(b.linked={model:{},view:{}},b._setModels().then(function(){b._setViews().then(function(){b._setListeners().done(function(){var a=vRap.Query.getApp(vRap.Properties.activeApp);a.references.controllers[b.properties.alias]=b,c.resolve()})})})):(vRap.Msg.alert(a.noAlias+" | "+b._objectNamespace),c.reject()),c.promise()},_setModels:function(){var a=this,b=new $.Deferred;return $.when(a._classIterator(a.config.models,"model")).done(function(){b.resolve()}),b.promise()},_setViews:function(){var a=this,b=new $.Deferred;return $.when(a._classIterator(a.config.views,"view")).done(function(){b.resolve()}),b.promise()},_setListeners:function(){var a=this,b=new $.Deferred,c=0;return a.config.listeners&&!$.isEmptyObject(a.config.listeners)?$.each(a.config.listeners,function(d,e){$.each(a.linked.view,function(b,c){c.subscribe(function(b,c){b===d&&a[e](b,c)})}),c+=1,Object.keys(a.config.listeners).length===c&&b.resolve()}):b.resolve(),b.promise()},_classIterator:function(b,c){var d=this,e=new $.Deferred,f=0;return b&&!$.isEmptyObject(b)?$.each(b,function(b,g){var h=$.extend({},g).namespace;delete g.namespace,g.domEl&&(g.domEl=$(g.domEl.selector)),$.when(vRap.Actions.create(b,h,g)).done(function(b){f+=1,g.alias?(d.linked[c][g.alias]=b,Object.keys(d.config.views).length===f&&e.resolve()):vRap.Msg.alert(a.noAlias+" | "+b._objectNamespace)})}):e.resolve(),e.promise()}}}(),{}),/**
 * This file is part of vRap.JS JavaScript Framework v1.0.0
 *
 * Copyright 2015, Jonathan Mauricio Sánchez Sanabria
 * Released under the MIT license
 */
vRap.Actions.define("Base.primitives.Interface",function(){return{extend:"Base.primitives.Foundation",properties:{type:"interface"},observerList:[],controller:{},_boot:function(){var a=this,b=new $.Deferred;a.controller=vRap.Query.getApp(vRap.Properties.activeApp).references.controllers,b.resolve()}}}(),{}),/**
 * This file is part of vRap.JS JavaScript Framework v1.0.0
 *
 * Copyright 2015, Jonathan Mauricio Sánchez Sanabria
 * Released under the MIT license
 */
vRap.Actions.define("Base.primitives.Model",function(){var a;return a=vRap.Locale.alertMessages,{extend:"Base.primitives.Foundation",properties:{type:"model"},_boot:function(){var b=this,c=new $.Deferred;return b.properties.data||b.config.url||b.config.api&&!$.isEmptyObject(b.config.api)?c.resolve():vRap.Msg.alert(a.noApiOrData+" | "+b._objectNamespace),c.promise()},_ajaxCall:function(b,c,d){var e,f,g,h=this;return h.properties.booted?(e=h.config.api&&h.config.api[b]?h.config.api[b]:!1,h.config.sendJSON&&(d=JSON.stringify(d)),h.config.url||e?(f={url:e?e.url:h.config.url,method:e?e.method:"sendData"===b&&h.config.sendMethod?h.config.sendMethod:c,data:d?d:null},h.config.ajaxConf.method&&delete h.config.ajaxConf.method,$.extend(f,h.config.ajaxConf),g=$.ajax(f),$.when(g).done(function(a,c,e){h._updateModel(b,d?$.extend(d,a):a)}),g):h._updateModel(b,d)):void vRap.Msg.alert(a.noApiUrl+" | "+h._objectNamespace)},_updateModel:function(a,b){var c,d=this,e=new $.Deferred,f="push";return c=b?b:d.properties.data,"read"===a?d.properties.data=c:"create"===a?"array"===$.type(d.properties.data)&&(d.config.prependRecord&&(f="unshift"),d.properties.data[f](c)):"update"===a?$.each(d.properties.data,function(a,c){c.id===b.id&&$.extend(d.properties.data[a],b)}):"delete"===a&&$.each(d.properties.data,function(a,c){c.id===b.id&&elf.properties.data.splice(a,1)}),e.resolve(c),d.publish("dataChange",c),e},getData:function(){var a=this;return a._ajaxCall("read","GET")},sendData:function(a){var b=this;return b._ajaxCall("sendData","POST",a||b.properties.data)},sendRecord:function(a){var b,c,d=this;return a&&a.id?(b="update",c="PUT",d.config.forceParamId||(d.config.url=d.config.url+"/"+a.id,delete a.id)):(b="create",c="POST"),d._ajaxCall(b,c,a)},deleteRecord:function(a){var b=this,c=null;return b.config.forceParamId?c={id:a}:b.config.url=b.config.url+"/"+a,b._ajaxCall("delete","DELETE",c)}}}(),{}),/**
 * This file is part of vRap.JS JavaScript Framework v1.0.0
 *
 * Copyright 2015, Jonathan Mauricio Sánchez Sanabria
 * Released under the MIT license
 */
vRap.Actions.define("Base.primitives.View",function(){var a;return a=vRap.Locale.alertMessages,{extend:"Base.primitives.Foundation",properties:{type:"view"},_boot:function(){var b,c,d=this,e=new $.Deferred;return b=d.properties.domEl,b?b instanceof jQuery&&0!==b.length||(vRap.Msg.alert(a.badDomEl+" | "+d._objectNamespace),e.reject()):(b=d.properties.domEl=$('<div id="'+d.properties.id+'"></div>'),c=d.properties.insertTo?$(d.properties.insertTo.selector):$("body"),c instanceof jQuery&&c.length>0?c.append(b):(vRap.Msg.alert(a.badInsertEl+" | "+d._objectNamespace),e.reject())),"rejected"!==e.state()&&(d.properties.style&&b.attr("class",d.properties.style),$.when(d._setTemplate(),d._setModel(),d._setEvents()).done(function(){e.resolve()})),e.promise()},_setTemplate:function(){var a=this,b=new $.Deferred;return a.config.template?$.get(a.config.template,function(c){a.properties.template=$(c).html(),b.resolve()}):b.resolve(),b.promise()},_setModel:function(){var b=this,c=new $.Deferred;b.properties.model&&"string"===$.type(b.properties.model)&&(b.linked.model=vRap.Query.getObj(b.properties.model),b.linked.model&&(b.linked.model.subscribe(function(c,d){"dataChange"===c&&(b.refresh?b.refresh(d):vRap.Msg.alert(a.noRefresh+" | "+b._objectNamespace))}),delete b.properties.model)),c.resolve()},_setEvents:function(){var a=this,b=new $.Deferred;a.config.events&&!$.isEmptyObject(a.config.events)&&$.each(a.config.events,function(b,c){var d,e;d=b.substr(0,b.indexOf(" ")),e=b.substr(b.indexOf(" ")+1),a.properties.domEl.on(d,e,function(b){a[c]($(this),c,b)})}),b.resolve()},emit:function(a,b){var c=this;c.publish(a,b)}}}(),{});
//# sourceMappingURL=vrap-js-1.0.0.min.js.map